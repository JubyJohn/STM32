// PA1 - ANALOG PIN



/************** SINGLE CONVERSION *****************/

 --------
| adc.h  |
 --------

#ifndef ADC_H_
#define ADC_H_

#include <stdint.h>

void PA1_ADC_Init(void);
uint32_t adc_read(void);
void start_conversion(void);

#endif 

 --------
| adc.c  |
 --------

#include "stm32f4xx.h"
#include "adc.h"

#define GPIOAEN         (1<<0)
#define ADC1EN        	(1<<8)
#define ADC_CH1         (1<<0)
#define ADC_SEQ_LEN_1     0x00
#define CR2_ADON        (1<<0)
#define CR2_SWSTART     (1<<30)
#define SR_EOC          (1<<1)


void PA1_ADC_Init(void)
{
	/* 1.CONFIGURE GPIO PIN BELONGS TO ADC1 CHANNEL WITH DATASHEET FROM PG NO. 39 TABLE 8
	HERE PA1 - ADC1_1 CHANNEL
	ENABLING CORRESPONDING DATA BUS OF GPIO PORTA WITH REFERENCE MANUAL 6.3.1 RCC GPIOD */
	RCC ->AHB1ENR |= GPIOAEN;

  /* 2 SETTING PA1 TO ANALOG MODE (11) WITH REFERENCE MANUAL 8.4.1 */
	GPIOA ->MODER |= (1<<2);
	GPIOA ->MODER |= (1<<3);

	/*3 ENABLING CORRESPONDING DATA BUS OF ADC1 WITH REFERENCE MANUAL 6.3.12 RCC APB2ENR */
	RCC->APB2ENR |= ADC1EN;

	/*4. CONVERSION SEQUENCE START
	SEQUENCE REGISTER 3 FOR CHANNEL 1 WITH REFERENCE MANUAL 11.12.11 */
	ADC1->SQR3 = ADC_CH1;
	//SEQUENCE REGISTER 1 FOR LENGTH OF CONVERSION WITH REFERENCE MANUAL 11.12.9
	ADC1->SQR1 = ADC_SEQ_LEN_1;

	/*5.CONTROL REGISTER TO ENABLE ADC MODULE WITH REFERENCE MANUAL 11.12.3
	ADC1->CR2 |= CR2_ADON;

}

void start_conversion(void)
{
	//CONTROL REGISTER TO ENABLE START CONVERSION
	ADC1 ->CR2 |= CR2_SWSTART;
}

uint32_t adc_read(void)
{
	//STATUS REGISTER TO CHECK CONVERSION COMPLETE OR NOT WITH REFERENCE MANUAL 11.12.1
	while(!(ADC1 ->SR & SR_EOC))
	{

	}
   //WHEN CONVERSION COMPLETED ,RETURN TO DATA REGISTER
	return (ADC1 ->DR);
}

 --------
| main.c  |
 --------

#include <stdio.h>
#include <stdint.h>
#include "stm32f4xx.h"
#include "adc.h"


uint32_t sensor_value;

int main()
{
	PA1_ADC_Init();

	while(1)
	{
		start_conversion();
		sensor_value = adc_read();
		printf("sensor value : %d \n\t",(int)sensor_value);

	}
}
      /*CLICK DEBUG -> SWITCH -> EXPRESSION : ADD NEW = SENSOR VALUE
		THEN CLICK ON RESUME ICON & LATER PAUSE BUTTON
		  WILL SEE SINGLE VALUE*/


/************** CONTINUOUS CONVERSION *****************/

 --------
| adc.h  |
 --------

#ifndef ADC_H_
#define ADC_H_

#include <stdint.h>

void PA1_ADC_Init(void);
uint32_t adc_read(void);
void start_conversion(void);

#endif 

 --------
| adc.c  |
 --------

#include "stm32f4xx.h"
#include "adc.h"

#define GPIOAEN         (1<<0)
#define ADC1EN        	(1<<8)
#define ADC_CH1         (1<<0)
#define ADC_SEQ_LEN_1     0x00
#define CR2_ADON        (1<<0)
#define CR2_SWSTART     (1<<30)
#define SR_EOC          (1<<1)
#define CR2_CONT        (1<<1)

void PA1_ADC_Init(void)
{
	/*1.CONFIGURE GPIO PIN BELONGS TO ADC1 CHANNEL WITH DATASHEET FROM PG NO. 39 TABLE 8
		HERE PA1 - ADC1_1 CHANNEL
		ENABLING CORRESPONDING DATA BUS OF GPIO PORTA WITH REFERENCE MANUAL 6.3.1 RCC GPIOD*/
		RCC ->AHB1ENR |= GPIOAEN;

	/* 2 SETTING PA1 TO ANALOG MODE WITH REFERENCE MANUAL 8.4.1 */
		GPIOA ->MODER |= (1<<2);
		GPIOA ->MODER |= (1<<3);

		/*3 ENABLING CORRESPONDING DATA BUS OF ADC1 WITH REFERENCE MANUAL 6.3.12 RCC APB2ENR */
			RCC->APB2ENR |= ADC1EN;

		/*4. CONVERSION SEQUENCE START
			SEQUENCE REGISTER 3 FOR CHANNEL 1 WITH REFERENCE MANUAL 11.12.11 */
			ADC1->SQR3 = ADC_CH1;
			//SEQUENCE REGISTER 1 FOR LENGTH OF CONVERSION WITH REFERENCE MANUAL 11.12.9
			ADC1->SQR1 = ADC_SEQ_LEN_1;

		/*5.CONTROL REGISTER TO ENABLE ADC MODULE WITH REFERENCE MANUAL 11.12.3
			ADC1->CR2 |= CR2_ADON;

}

void start_conversion(void)
{
	//CONTROL REGISTER TO ENABLE CONTINUOUS CONVERSION
	ADC1 ->CR2 |= CR2_CONT;

	//CONTROL REGISTER TO ENABLE START CONVERSION
	ADC1 ->CR2 |= CR2_SWSTART;
}

uint32_t adc_read(void)
{
	//STATUS REGISTER TO CHECK CONVERSION COMPLETE OR NOT WITH REFERENCE MANUAL 11.12.1
	while(!(ADC1 ->SR & SR_EOC))
	{

	}
	 //WHEN CONVERSION COMPLETED ,RETURN TO DATA REGISTER
	return (ADC1 ->DR);
}


 --------
| main.c  |
 --------

#include <stdio.h>
#include <stdint.h>
#include "stm32f4xx.h"
#include "adc.h"


 uint32_t sensor_value;

int main()
{
	PA1_ADC_Init();
	start_conversion();

	while(1)
	{

		sensor_value = adc_read();
		printf("sensor value : %d \n\t",(int)sensor_value);

	}
}

       /*CLICK DEBUG -> SWITCH -> LIVE EXPRESSION : ADD NEW = SENSOR VALUE
		THEN CLICK ON RESUME ICON
		CONTINUOUS VALUE WILL DISPLAYED*/

